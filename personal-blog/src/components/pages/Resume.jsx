import React, { useEffect, useState } from 'react';
import './Resume.css';
import * as pdfjsLib from 'pdfjs-dist/build/pdf';

function PdfViewer() {
    const [pdf, setPdf] = useState(null);
    const [pageNumber, setPageNumber] = useState(1);
    const [totalPages, setTotalPages] = useState(0);

    useEffect(() => {
        const loadPDF = () => {
            pdfjsLib.GlobalWorkerOptions.workerSrc = '/pdf.worker.mjs'; // Adjust path to public folder
            const url = '/assets/Dossier_SaidjiYounes.pdf'; // Ensure this path is correct

            const loadingTask = pdfjsLib.getDocument(url);
            loadingTask.promise.then(loadedPdf => {
                setPdf(loadedPdf);
                setTotalPages(loadedPdf.numPages); // Set the total number of pages
                renderPage(loadedPdf, 1); // Render the first page
            }).catch(error => {
                console.error('Error loading PDF:', error);
            });
        };

        const renderPage = (pdf, pageNum) => {
            pdf.getPage(pageNum).then(page => {
                console.log(`Page ${pageNum} loaded`);

                const scale = 1.5;
                const viewport = page.getViewport({ scale });

                const canvas = document.getElementById('pdfCanvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                page.render(renderContext);
            });
        };

        loadPDF();
    }, []);

    const goToNextPage = () => {
        if (pdf && pageNumber < totalPages) {
            setPageNumber(prevPage => prevPage + 1);
            renderPage(pdf, pageNumber + 1);
        }
    };

    const goToPreviousPage = () => {
        if (pdf && pageNumber > 1) {
            setPageNumber(prevPage => prevPage - 1);
            renderPage(pdf, pageNumber - 1);
        }
    };

    const renderPage = (pdf, pageNum) => {
        pdf.getPage(pageNum).then(page => {
            const scale = 1.5;
            const viewport = page.getViewport({ scale });

            const canvas = document.getElementById('pdfCanvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;

            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };
            page.render(renderContext);
        });
    };

    return (
        <div className="pdf-container">
            <canvas id="pdfCanvas"></canvas>
            <div className="pdf-controls">
                <button onClick={goToPreviousPage} disabled={pageNumber <= 1}>Prev</button>
                <span>Page {pageNumber} of {totalPages}</span>
                <button onClick={goToNextPage} disabled={pageNumber >= totalPages}>Next</button>
            </div>
            <a href="/assets/Dossier_SaidjiYounes.pdf" download="Dossier_SaidjiYounes.pdf" className="download-button">Download PDF</a>
        </div>
    );
}

function Resume() {
    return (
        <div className="resume-container">

            <div className="doodles">
                <svg className="Heart9" viewBox="-15 0 41 39" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3.14897 0.528877C1.57448 1.08342 0 4.68792 0 7.8072C0.0749755 18.6207 7.9474 32.3455 16.9445 37.1977L20.2434 39L22.7925 37.5443C32.4644 31.9989 42.2862 16.056 40.8616 8.29242C39.4371 0.598194 33.4391 0.182293 24.8169 7.25266C22.7176 8.98559 20.6932 10.4413 20.3933 10.3719C20.0934 10.3719 18.369 8.63901 16.5696 6.55949C11.8461 0.944782 7.3476 -1.06542 3.14897 0.528877ZM9.59686 6.00495C10.4966 6.55949 12.5959 8.91628 14.2453 11.1344C17.3943 15.4321 19.1187 16.7491 20.9931 16.1253C21.5929 15.9866 24.1421 14.0458 26.6163 11.8276C31.4897 7.52993 34.1138 6.00495 35.2385 6.6288C35.6883 6.83675 35.9882 8.70832 35.9882 10.7185C35.9882 16.056 32.0145 23.057 25.2667 29.5728C22.4177 32.4149 19.6436 34.7023 19.1187 34.7023C17.3943 34.7023 12.071 28.4638 9.37193 23.3343C6.52287 18.0662 4.12365 9.05491 4.8734 6.49017C5.32326 4.6186 7.19764 4.41065 9.59686 6.00495Z"/>
                </svg>
                <svg className="Star14" viewBox="0 0 36 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.9081 0.771792C15.4703 1.21881 14.6432 3.9009 14.0108 7.25351L12.8919 12.9753L7.54054 14.9422C2.38378 16.8643 0 18.4289 0 19.904C0 21.111 1.84865 22.2285 4.71892 22.7202C10.6541 23.7931 13.8162 24.5977 14.6432 25.2682C15.1297 25.6705 16.5892 28.5761 18 31.7499C20.9189 38.5445 22.0865 40.5114 23.4973 40.9137C25.9784 41.6289 26.8541 37.9634 26.6108 27.4586C26.5622 24.5083 26.6595 21.6027 26.8541 20.9769C27.0486 20.2616 28.9459 18.5183 31.6216 16.5961C35.3676 13.8246 36 13.1541 36 12.0366C36 10.2485 34.7838 10.025 29.1405 10.8296C22.8162 11.7684 22.5243 11.6343 20.8703 6.35948C18.973 0.324779 17.7081 -1.10567 15.9081 0.771792ZM18.8757 9.13097C20.3838 13.8693 21.9892 14.5845 28.8 13.6011L30.8919 13.3329L29.1892 14.7187C28.2649 15.4786 26.8054 16.7302 25.9297 17.4007C23.7892 19.2335 23.3514 21.0663 23.3514 28.9784C23.3514 33.1357 23.1568 35.7283 22.9135 35.4601C22.6703 35.2366 21.5514 32.8227 20.4324 30.1407C19.2649 27.4139 17.9514 24.6871 17.4649 24.0613C16.2973 22.4967 12.6 21.111 8.07568 20.4404C6.03243 20.1722 4.37838 19.7699 4.37838 19.6358C4.37838 19.1441 11.5297 16.5067 12.8432 16.5067C14.1568 16.5067 14.4 15.9703 16.3459 8.77336C16.7838 7.1194 17.2703 5.77836 17.4649 5.77836C17.6595 5.77836 18.2919 7.29821 18.8757 9.13097Z"/>
                </svg>
                <svg className="Star13" viewBox="0 0 43 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M35.8718 38.5891C33.6062 37.1948 30.8372 35.547 29.7673 34.9766L27.7534 33.9626L25.1103 36.9413C23.2852 39.0327 22.0895 39.8566 21.1455 39.7298C19.9498 39.5397 19.8239 39.0327 19.5092 33.8358L19.1946 28.132L10.5727 24.266C1.38453 20.1466 0 19.3227 0 17.9284C0 16.2173 2.83198 15.2666 9.43995 14.7596C19.8868 14.0625 19.1316 14.6329 19.5092 6.8376C19.8239 0.563367 19.8868 0.246486 21.2713 0.0563578C23.2223 -0.260523 24.1033 0.626743 27.8164 6.14047C31.2148 11.2106 31.1518 11.2106 35.9977 8.73889C39.0814 7.15448 41.284 7.21786 42.1651 8.80226C42.9832 10.3233 42.9832 10.3233 38.8926 15.837C37.2563 18.1819 35.8718 20.5268 35.8718 21.0339C35.8718 21.6042 37.6339 25.8504 39.7107 30.4769C43.6755 39.0961 43.9272 40.5537 41.1582 40.9973C40.4659 41.0607 38.1374 39.9833 35.8718 38.5891ZM34.9278 29.9065L33.2915 26.2307L32.0329 27.7517C31.4036 28.5756 30.8372 29.5263 30.8372 29.9699C30.8372 30.667 35.9347 34.2795 36.3753 33.8358C36.5011 33.7091 35.8718 31.9346 34.9278 29.9065ZM23.9145 31.5543C23.9145 31.2374 23.6628 30.9839 23.2852 30.9839C22.9705 30.9839 22.6559 31.4275 22.6559 31.9979C22.6559 32.5049 22.9705 32.7584 23.2852 32.5683C23.6628 32.3782 23.9145 31.9346 23.9145 31.5543ZM28.9492 24.0125C30.5854 20.7804 30.7113 20.0198 30.082 18.6256C29.3268 16.851 28.5086 16.7243 25.0473 17.7383C22.6559 18.3721 22.6559 18.3721 22.6559 21.8577C22.6559 25.0899 22.7817 25.4068 24.7327 26.5476C25.8025 27.2447 26.8095 27.8151 26.8724 27.8151C26.9982 27.8151 27.8793 26.1039 28.9492 24.0125ZM19.1316 21.7944C20.0756 19.196 18.0618 18.0552 13.8453 18.8157L11.0133 19.3227L14.1599 21.0339C17.81 22.9351 18.6282 23.0619 19.1316 21.7944ZM26.306 12.6682C27.0612 12.2246 26.9982 11.8443 26.1801 10.3233C25.6767 9.30927 24.6697 7.78825 23.9775 6.90098L22.6559 5.31658V9.30927C22.6559 12.9851 22.7817 13.2386 24.1033 13.2386C24.8585 13.2386 25.8655 12.9851 26.306 12.6682Z" />
                </svg>
                <svg className="Star12" viewBox="0 0 45 46" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.1723 1.003C18.49 2.06173 16.7843 9.36136 15.8973 15.2679C15.5562 17.2739 14.9421 18.7227 14.328 19.0013C13.7822 19.2242 10.7119 19.7815 7.50516 20.283C2.18332 21.0631 0 22.0103 0 23.5149C0 24.685 3.00207 26.1338 7.43693 27.0254C10.0979 27.5269 12.9635 28.4184 13.714 28.9199C14.601 29.4772 15.6926 31.9289 17.0572 36.0524C19.8546 44.9123 21.2191 46.8625 23.8118 45.6924C25.5858 44.968 25.7905 44.355 27.2233 35.4394C27.9056 31.2603 28.5878 27.694 28.8608 27.5269C29.0655 27.3597 32.0675 26.1338 35.5472 24.7965C44.8945 21.1745 46.8732 19.3914 43.3935 17.5526C42.0971 16.8282 40.5961 16.7167 35.5472 17.0511C28.5878 17.4968 27.5644 17.1625 27.0186 14.2649C26.8139 13.3177 26.3363 10.4201 25.8587 7.80114C24.9035 2.00601 23.7436 -7.49011e-07 21.4921 -7.49011e-07C20.6051 -7.49011e-07 19.5134 0.445779 19.1723 1.003ZM22.1743 11.5345C23.266 19.4471 24.4941 20.6173 31.1805 20.6173C33.5685 20.6173 35.479 20.7845 35.479 21.0073C35.479 21.286 33.5685 22.0661 31.2488 22.8462C25.4493 24.7965 24.6988 25.8552 23.7436 32.9877C23.266 36.331 22.7202 39.0057 22.379 39.0057C22.1061 39.0057 21.5603 38.0584 21.2191 36.8882C20.878 35.7738 20.1275 33.3777 19.5134 31.5389C18.2853 27.5269 16.5114 25.9666 12.0765 24.7407C9.27911 23.9606 8.86974 23.7377 9.82494 23.292C10.5072 23.0134 12.4176 22.7347 14.1234 22.679C17.8077 22.679 17.8759 22.6233 19.4452 14.3207C20.1275 11.033 20.878 8.35836 21.2191 8.35836C21.4921 8.35836 21.9697 9.80714 22.1743 11.5345Z" />
                </svg>
            </div>

            <div className="align-left">
                <h1 className="title">My CV</h1>
            </div>
            <PdfViewer />
        </div>
    );
}

export default Resume;
